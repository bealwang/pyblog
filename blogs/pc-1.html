<!DOCTYPE html>
<html>
<head>
    <title>linux机群系统DIY</title>
    <meta http-equiv="Content-Type" content="text/html; charset="utf-8" >
    <meta name = "author" content = "genialwang" >
    <meta name="description" content="linux机群系统DIY"><meta name="Keywords" content="python,静态,博客,seo,代码高亮">

    <link rel="alternate" hreflang="zh-Hans" href="genialwang.com/blogs/pc-1.html">
    <link rel="stylesheet" href="../static/css/uikit.almost-flat.min.css" />
    <link rel="stylesheet" href="../static/css/font-awesome.min.css" />
    <link rel="stylesheet" href="../static/css/font-awesome-ie7.min.css" />
    <link rel="stylesheet" href="../static/css/components/slidenav.almost-flat.min.css" />
    <link rel="stylesheet" href="../static/css/highlight.css" />
    <link rel="stylesheet" href="../static/css/style.css" />
    <link rel="stylesheet" href="../static/css/components/sticky.almost-flat.min.css" />
    <link rel="stylesheet" href="../static/css/components/dotnav.almost-flat.min.css" />
    <link rel="stylesheet" href="../static/css/components/pygments.css" />
    <link rel="stylesheet" href="../static/css/genialwang.css" />
    <script type="text/x-mathjax-config"> 
        MathJax.Hub.Config({ 
            tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]} 
        }); 
    </script>
    <script type="text/javascript"
        src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
</head>
<body>
    <div data-uk-sticky>
        <nav class="uk-navbar uk-navbar-attached">
            <div class="uk-container uk-container-center">
                <a href="../aboutme.html" class="uk-navbar-brand">GenialWang</a>
                <ul class="uk-navbar-nav">
                    <li><a href="../index.html"><i class="uk-icon-book"></i> 博客</a></li>
                    <li><a href="../aboutme.html"><i class="uk-icon-user"></i> 关于我</a></li>
                </ul>
            </div>
        </nav>
    </div>

    <div class="uk-container" id="margin-blog">
        <div class="uk-grid" id="my_grid">
            <div class="uk-width-1-6 uk-visible-large uk-hidden-touch" id="my_navigation">
                <div data-uk-sticky="{top:60, boundary:true}">
                    <ul class="uk-dotnav uk-flex-column" data-uk-scrollspy-nav="{closest:'li', smoothscroll:true}">
                        <li class="uk-active"><a href="#toc-0">情景</a></li>
                        
                        
                        <li><a href="#toc-1">操作系统的安装</a></li>
                        
                        
                        <li><a href="#toc-2">操作系统配置</a></li>
                        
                        
                        <li><a href="#toc-3">MPICH的安装与配置</a></li>
                        
                        
                        <li><a href="#toc-4">NFS</a></li>
                        
                        
                        <li><a href="#toc-5">NFS的安装</a></li>
                        
                        
                        <li><a href="#toc-6">NFS服务端的配置</a></li>
                        
                        
                        <li><a href="#toc-7">NFS服务端测试</a></li>
                        
                        
                        <li><a href="#toc-8">NFS客户端配置</a></li>
                        
                        
                        <li><a href="#toc-9">其他</a></li>
                        
                        
                   </ul>
                </div>
            </div>
            <div class="uk-width-5-6 uk-container-center uk-hidden-touch" id="my_blog">
                <div class="uk-panel uk-panel-box" id="my_title">
                    <h1>linux机群系统DIY</h1>
                </div>
                <div class="uk-panel uk-panel-box" id="my_content">
                    <h2 id="toc-0">情景</h2>
<p>没有云平台?没有昂贵,完备的并行自动化部署工具?只有计算机硬件设备?但是还是任性的想优雅的使用并行环境?
下面就让我们一起愉快的经历DIY并行环境的历程吧...</p>
<div class="uk-alert uk-alert-danger">

    <i class="uk-icon-bug"></i>

    注意以下的操作在所有节点上均需要执行
</div><h2 id="toc-1">操作系统的安装</h2>
<p>这里主要有几款常见的linux操作系统:</p>
<ul>
<li>Redhat Linux</li>
<li>SuSE Linux</li>
<li>Debian GNU/Linux</li>
</ul>
<p>前两个版本具有可管理性强和用户界面友好等优点,后一个具有可裁剪性强的优点,按照需求任意选择一款即可.</p>
<h2 id="toc-2">操作系统配置</h2>
<h3>主机名配置</h3>
<p>通过修改<b class="uk-text-success">/etc/sysconfig/network</b>文件中的<b class="uk-text-success">HOSTNAME</b>字段
可以修改主机名,但是需要重新启动系统生效.
本博客假设使用的主机名和ip分别是:<br>
  vm-1-1         10.0.0.11   (主节点)<br>
  vm-1-2         10.0.0.12<br>
  vm-1-3         10.0.0.13<br>
  vm-1-4         10.0.0.14</p>
<h3>网络配置</h3>
<ol>
<li>修改<b class="uk-text-success">/etc/hosts</b>文件中的主机列表,将所有的计算节点名以及ip信息写入,形式如下:<br>
10.0.0.11    vm-1-1<br>
10.0.0.12    vm-1-2<br>
10.0.0.13    vm-1-3<br>
10.0.0.14    vm-1-4    </li>
<li>配置防火墙
可以使用如下命令查看当前防火墙设置:<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre>iptables -L
</pre></div>
</td></tr></table></div>
配置防火墙,使得远程用户可通过ssh正常访问,命令如下:<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre>iptables -A INPUT -p tcp -dport <span class="m">22</span> -j A:
</pre></div>
</td></tr></table></div>
</li>
<li>用ping命令检查节点间的互通状态:
<a href="./img/1.jpg" data-uk-lightbox="{group:'网络配置'}" title="检查节点互通">
 <img src="./img/1.jpg" alt="图片挂了" />
</a>
确保节点之间两两互通,对于不能互通的节点对,可以按照如下命令格式添加路由:<br>
route add 网段地址 Mask 子网掩码 网关地址<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre>route add 172.21.0.0 Mask 255.255.0.0 172.21.0.1
</pre></div>
</td></tr></table></div>
</li>
</ol>
<h3>新增用户</h3>
<p>可以使用命令adduser命令增加并行计算用户,格式如下:</p>
<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre>adduser mpiuser
</pre></div>
</td></tr></table></div>
<h3>配置SSH(Secure SHell)服务</h3>
<p>我们选用linux平台广泛使用的OpenSSH,它由服务器软件包openssh-server和客户端程序openssh-clientis组成,
默认情况下,两者已经安装在你的系统中了.</p>
<ol>
<li>查看方式:<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre>rpm -q openssh-server
rpm -q openssh-clients
</pre></div>
</td></tr></table></div>
</li>
<li>启动和查询SSH服务
一般linux默认开机启动SSH服务,所以大家可以直接使用可使用<b class="uk-text-success">ntsysv</b>命令,将SSH服
务设置为开机自启动服务<br>
也可以使用如下命令启动/重启/停止/查询SSH服务<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre>service sshd start/restart/stop/status
</pre></div>
</td></tr></table></div>
</li>
<li><p>配置节点之间无密码ssh互通
相应的示例命令如下:</p>
<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre>ssh-keygen -t rsa -C <span class="s2">&quot;youremail@sina.com&quot;</span>
cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys
ssh-copy-id mpiuser@vm-1-1
</pre></div>
</td></tr></table></div>
<div class="uk-alert uk-alert-warning">

 <i class="uk-icon-warning"></i>

 注意这个操作在所有节点上的mpiuser用户下均需执行,直到计算节点-->主节点以及主节点-->计算节点均可互通
</div></li>
</ol>
<p>到此为止,组成并行计算环境的所有计算节点上均具有相同的主机列表,节点间均可互通.</p>
<h2 id="toc-3">MPICH的安装与配置</h2>
<div class="uk-alert uk-alert-danger">

    <i class="uk-icon-bug"></i>

    注意以下的操作在所有节点上均需要执行
</div><h3>MPI的安装</h3>
<ol>
<li>下载MPICH软件安装包mpich2    <b class="uk-text-success">1.2.1p1.tar.gz</b>
以mpiuser用户解压软件包,创建安装路径,配置安装路径,编译,安装.命令如下:<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre>tar zxvf mpich2-1.2.1p1.tar.gz
<span class="nb">cd </span>mpich2-1.2.1p1
mkdir /home/mpiuser/mpi2-1.2.1p1_install
./configure –prefix<span class="o">=</span>/home/mpiuser/mpi2-1.2.1p1_install
make <span class="o">&amp;&amp;</span> make install
</pre></div>
</td></tr></table></div>
</li>
<li>设置环境变量
在<b class="uk-text-success">/home/mpiuser/.bashrc</b>文件中添加如下语句:<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span>/home/mpiuser/mpi2-1.2.1p1_install/bin:<span class="nv">$PATH</span>
</pre></div>
</td></tr></table></div>
运行<b class="uk-text-success">source</b>命令使我们的修改生效.</li>
<li>检查安装是否成功
<a href="./img/2.jpg" data-uk-lightbox="{group:'安装mpi'}" title="查看安装是否成功">
 <img src="./img/2.jpg" alt="图片挂了" />
</a></li>
</ol>
<h3>MPI的配置</h3>
<ol>
<li>配置mdp.conf文件
在mpiuser的主目录下创建文件.mdp.conf<br>
编辑.mdp.conf文件,添加语句:<b class="uk-text-success">secretword=111111</b><br>
修改.mdp.conf文件的访问权限:<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre>chmod <span class="m">644</span> .mdp.conf
</pre></div>
</td></tr></table></div>
</li>
<li>启动mdp守护进程
在mpiuser的主目录下,创建mpd.hosts文件,将计算节点名称列表填入,本博客使用的是vm-1-2~vm-1-4.<br>
启动各节点上的mdp<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre>mdpboot -n 启动个数 -f ~/mdp.hosts
</pre></div>
</td></tr></table></div>
检查是否启动正常:
<a href="./img/3.jpg" data-uk-lightbox="{group:'启动mdp'}" title="检查mdp启动情况">
 <img src="./img/3.jpg" alt="图片挂了" />
</a>
mdp的关闭命令是<b class="uk-text-success">mdpallexit</b></li>
</ol>
<h3>MPI的使用</h3>
<p>我们只关心并行环境的搭建,对于MPI的使用,咱们就一带而过啦.
<a href="./img/4.jpg" data-uk-lightbox="{group:'mpi的使用'}" title="mpi的使用">
    <img src="./img/4.jpg" alt="图片挂了" />
</a></p>
<h2 id="toc-4">NFS</h2>
<p>网络文件系统NFS(Network File System)是<b class="uk-text-success">UNIX\Linux</b>系统支持的一种网络文件服务.
通过NFS,网络中的计算机可以发布共享信息,远程客户端能够像使用本地文件一样访问该共享资源.
<a href="./img/5.png" data-uk-lightbox="{group:'NFS'}" title="NFS">
    <img src="./img/5.png" alt="图片挂了" />
</a></p>
<p>它有如下优点:</p>
<ul>
<li>节约磁盘空间</li>
<li>节约硬件设备</li>
<li>共享用户和应用程序目录</li>
</ul>
<h2 id="toc-5">NFS的安装</h2>
<p>相关rpm软件包:<br>
nfs-utils-<em>.rpm:NFS服务主程序包<br>
Portmap-</em>.rpm:记录服务的端口映射信息<br>
安装命令:</p>
<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre>rpm -ivh nfs-utils-*.rpm
</pre></div>
</td></tr></table></div>
<h2 id="toc-6">NFS服务端的配置</h2>
<ol>
<li>配置<b class="uk-text-success">/etc/exports</b>文件:<ul>
<li>用于定义需要共享的目录，以及访问对象的控制</li>
<li>默认情况下，该文件内容为空，即不共享任何目录</li>
<li>当需要共享目录时，需要管理员手动设置</li>
</ul>
</li>
</ol>
<p>发布共享目录的格式:<br>
共享目录    [客户端1(参数1,参数2,…)] [客户端2(参数1,参数2,…)]…<br>
共享目录:指NFS服务器上需要给客户端共享出来的目录,在设置目录时需要使用绝对路径<br>
客户端  :是指所有可以访问共享目录的计算机<br>
<a href="./img/6.png" data-uk-lightbox="{group:'NFS'}" title="客户端">
    <img src="./img/6.png" alt="图片挂了" />
</a></p>
<p>参数    :是指客户端对共享目录的访问权限设置
<a href="./img/7.png" data-uk-lightbox="{group:'NFS'}" title="参数">
    <img src="./img/7.png" alt="图片挂了" />
</a></p>
<p>示例:
<a href="./img/8.jpg" data-uk-lightbox="{group:'NFS'}" title="示例">
    <img src="./img/8.jpg" alt="图片挂了" />
</a></p>
<p>在NFS服务器上，共享如下目录：</p>
<ul>
<li>/media目录，允许所有客户端访问，但只具有只读权限</li>
<li>/NFS/public目录，允许192.168.1.0/24和196.168.2.0/24网段的客户端访问，且只具有只读权限</li>
<li>/NFS/team1目录，允许来自.team1.apple域的客户端访问，具有读写权限</li>
<li>/NFS/works目录，允许192.168.1.0/24网段客户端访问，并将root用户映射为匿名用户</li>
<li>/NFS/test目录，所有客户端允许访问，所有用户映射为匿名用户，并指定匿名用户的UID和GID均为65534</li>
<li>/NFS/security目录，仅允许192.168.1.254客户端访问，具有读写权限</li>
</ul>
<ol>
<li>配置NFS固定端口
针对场景:NFS服务每次启动,其对应的端口号都会随机变化,这对服务器防火墙配置带来负担.因此,可以通过配置,固定NFS服务所用端口.<br>
配置文件<b class="uk-text-success">/etc/sysconfig/nfs</b>增加如下配置行:<br>
MOUNT_PORT=”5001”<br>
STATD_PORT=“5002”<br>
LOCKD_UDPPORT=“5003”<br>
LOCKD_TCPPORT=“5003”<br>
RQUOTAD_PORT=“5004”</li>
</ol>
<h2 id="toc-7">NFS服务端测试</h2>
<p>NFS服务启动/停止/重启/查询状态命令:</p>
<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre>service portmap start/stop/restart/status
service nfs start/stop/restart/status
</pre></div>
</td></tr></table></div>
<p>开机自动启动NFS服务命令:</p>
<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre>chkconfig nfs on
</pre></div>
</td></tr></table></div>
<p>停止开机自动启动NFS:</p>
<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre>chkconfig nfs off
</pre></div>
</td></tr></table></div>
<h2 id="toc-8">NFS客户端配置</h2>
<ol>
<li>查看NFS服务器的共享目录:<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre>showmount –e 服务器名/IP
</pre></div>
</td></tr></table></div>
</li>
<li>挂载NFS文件系统:<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre>mount –t nfs NFS服务器IP地址/主机名：共享目录  本地挂载点
</pre></div>
</td></tr></table></div>
例：将192.168.1.254上的/tmp目录挂载到本地的/test目录<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre>mount –t nfs 192.168.1.254:/tmp /test
</pre></div>
</td></tr></table></div>
</li>
<li>卸载NFS文件系统:<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre>umount 本地挂载点
</pre></div>
</td></tr></table></div>
</li>
<li>开机自动挂载NFS
配置客户端<b class="uk-text-success">/etc/fstab</b>文件<br>
挂载目录格式：<br>
NFS服务器IP:共享目录  本地挂载点  nfs defaults 0 0<br>
<a href="./img/9.jpg" data-uk-lightbox="{group:'NFS'}" title="自动挂载NFS">
 <img src="./img/9.jpg" alt="图片挂了" />
</a></li>
</ol>
<h2 id="toc-9">其他</h2>
<p>可能有人会这么问:如果我需要配置一个大型机群系统,这样每个节点都需要配置,那我岂不是需要一台一
台计算机去操作?这看起来好蠢啊!<br>
不是看起来很蠢,这本来就太蠢了...所以,我们需要一个更高效的方法,找更多的人帮你配!!好吧开个玩笑,
我要说的是有个系统可以帮助我们,那就是大名鼎鼎的Network Information Service,小名叫NIS.但如果不
想出事的话,你最好只是在内网使用,因为它的安全性真的不是很好.</p>

                </div>
                <div class="uk-alert uk-alert-success">
                    若文中有误,欢迎指正
                </div>
                <div class="uk-container uk-container-center">
                    <!-- UY BEGIN -->
                    <div id="uyan_frame"></div>
                    <!-- UY END -->
                </div>
            </div>

            <div class="uk-width-1-1 uk-hidden-notouch" id="my_grid">
                <div class="uk-panel uk-panel-box" id="my_title">
                    <h1>linux机群系统DIY</h1>
                </div>
                <div class="uk-panel uk-panel-box" id="my_content">
                    <h2 id="toc-0">情景</h2>
<p>没有云平台?没有昂贵,完备的并行自动化部署工具?只有计算机硬件设备?但是还是任性的想优雅的使用并行环境?
下面就让我们一起愉快的经历DIY并行环境的历程吧...</p>
<div class="uk-alert uk-alert-danger">

    <i class="uk-icon-bug"></i>

    注意以下的操作在所有节点上均需要执行
</div><h2 id="toc-1">操作系统的安装</h2>
<p>这里主要有几款常见的linux操作系统:</p>
<ul>
<li>Redhat Linux</li>
<li>SuSE Linux</li>
<li>Debian GNU/Linux</li>
</ul>
<p>前两个版本具有可管理性强和用户界面友好等优点,后一个具有可裁剪性强的优点,按照需求任意选择一款即可.</p>
<h2 id="toc-2">操作系统配置</h2>
<h3>主机名配置</h3>
<p>通过修改<b class="uk-text-success">/etc/sysconfig/network</b>文件中的<b class="uk-text-success">HOSTNAME</b>字段
可以修改主机名,但是需要重新启动系统生效.
本博客假设使用的主机名和ip分别是:<br>
  vm-1-1         10.0.0.11   (主节点)<br>
  vm-1-2         10.0.0.12<br>
  vm-1-3         10.0.0.13<br>
  vm-1-4         10.0.0.14</p>
<h3>网络配置</h3>
<ol>
<li>修改<b class="uk-text-success">/etc/hosts</b>文件中的主机列表,将所有的计算节点名以及ip信息写入,形式如下:<br>
10.0.0.11    vm-1-1<br>
10.0.0.12    vm-1-2<br>
10.0.0.13    vm-1-3<br>
10.0.0.14    vm-1-4    </li>
<li>配置防火墙
可以使用如下命令查看当前防火墙设置:<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre>iptables -L
</pre></div>
</td></tr></table></div>
配置防火墙,使得远程用户可通过ssh正常访问,命令如下:<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre>iptables -A INPUT -p tcp -dport <span class="m">22</span> -j A:
</pre></div>
</td></tr></table></div>
</li>
<li>用ping命令检查节点间的互通状态:
<a href="./img/1.jpg" data-uk-lightbox="{group:'网络配置'}" title="检查节点互通">
 <img src="./img/1.jpg" alt="图片挂了" />
</a>
确保节点之间两两互通,对于不能互通的节点对,可以按照如下命令格式添加路由:<br>
route add 网段地址 Mask 子网掩码 网关地址<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre>route add 172.21.0.0 Mask 255.255.0.0 172.21.0.1
</pre></div>
</td></tr></table></div>
</li>
</ol>
<h3>新增用户</h3>
<p>可以使用命令adduser命令增加并行计算用户,格式如下:</p>
<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre>adduser mpiuser
</pre></div>
</td></tr></table></div>
<h3>配置SSH(Secure SHell)服务</h3>
<p>我们选用linux平台广泛使用的OpenSSH,它由服务器软件包openssh-server和客户端程序openssh-clientis组成,
默认情况下,两者已经安装在你的系统中了.</p>
<ol>
<li>查看方式:<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre>rpm -q openssh-server
rpm -q openssh-clients
</pre></div>
</td></tr></table></div>
</li>
<li>启动和查询SSH服务
一般linux默认开机启动SSH服务,所以大家可以直接使用可使用<b class="uk-text-success">ntsysv</b>命令,将SSH服
务设置为开机自启动服务<br>
也可以使用如下命令启动/重启/停止/查询SSH服务<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre>service sshd start/restart/stop/status
</pre></div>
</td></tr></table></div>
</li>
<li><p>配置节点之间无密码ssh互通
相应的示例命令如下:</p>
<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre>ssh-keygen -t rsa -C <span class="s2">&quot;youremail@sina.com&quot;</span>
cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys
ssh-copy-id mpiuser@vm-1-1
</pre></div>
</td></tr></table></div>
<div class="uk-alert uk-alert-warning">

 <i class="uk-icon-warning"></i>

 注意这个操作在所有节点上的mpiuser用户下均需执行,直到计算节点-->主节点以及主节点-->计算节点均可互通
</div></li>
</ol>
<p>到此为止,组成并行计算环境的所有计算节点上均具有相同的主机列表,节点间均可互通.</p>
<h2 id="toc-3">MPICH的安装与配置</h2>
<div class="uk-alert uk-alert-danger">

    <i class="uk-icon-bug"></i>

    注意以下的操作在所有节点上均需要执行
</div><h3>MPI的安装</h3>
<ol>
<li>下载MPICH软件安装包mpich2    <b class="uk-text-success">1.2.1p1.tar.gz</b>
以mpiuser用户解压软件包,创建安装路径,配置安装路径,编译,安装.命令如下:<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre>tar zxvf mpich2-1.2.1p1.tar.gz
<span class="nb">cd </span>mpich2-1.2.1p1
mkdir /home/mpiuser/mpi2-1.2.1p1_install
./configure –prefix<span class="o">=</span>/home/mpiuser/mpi2-1.2.1p1_install
make <span class="o">&amp;&amp;</span> make install
</pre></div>
</td></tr></table></div>
</li>
<li>设置环境变量
在<b class="uk-text-success">/home/mpiuser/.bashrc</b>文件中添加如下语句:<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span>/home/mpiuser/mpi2-1.2.1p1_install/bin:<span class="nv">$PATH</span>
</pre></div>
</td></tr></table></div>
运行<b class="uk-text-success">source</b>命令使我们的修改生效.</li>
<li>检查安装是否成功
<a href="./img/2.jpg" data-uk-lightbox="{group:'安装mpi'}" title="查看安装是否成功">
 <img src="./img/2.jpg" alt="图片挂了" />
</a></li>
</ol>
<h3>MPI的配置</h3>
<ol>
<li>配置mdp.conf文件
在mpiuser的主目录下创建文件.mdp.conf<br>
编辑.mdp.conf文件,添加语句:<b class="uk-text-success">secretword=111111</b><br>
修改.mdp.conf文件的访问权限:<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre>chmod <span class="m">644</span> .mdp.conf
</pre></div>
</td></tr></table></div>
</li>
<li>启动mdp守护进程
在mpiuser的主目录下,创建mpd.hosts文件,将计算节点名称列表填入,本博客使用的是vm-1-2~vm-1-4.<br>
启动各节点上的mdp<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre>mdpboot -n 启动个数 -f ~/mdp.hosts
</pre></div>
</td></tr></table></div>
检查是否启动正常:
<a href="./img/3.jpg" data-uk-lightbox="{group:'启动mdp'}" title="检查mdp启动情况">
 <img src="./img/3.jpg" alt="图片挂了" />
</a>
mdp的关闭命令是<b class="uk-text-success">mdpallexit</b></li>
</ol>
<h3>MPI的使用</h3>
<p>我们只关心并行环境的搭建,对于MPI的使用,咱们就一带而过啦.
<a href="./img/4.jpg" data-uk-lightbox="{group:'mpi的使用'}" title="mpi的使用">
    <img src="./img/4.jpg" alt="图片挂了" />
</a></p>
<h2 id="toc-4">NFS</h2>
<p>网络文件系统NFS(Network File System)是<b class="uk-text-success">UNIX\Linux</b>系统支持的一种网络文件服务.
通过NFS,网络中的计算机可以发布共享信息,远程客户端能够像使用本地文件一样访问该共享资源.
<a href="./img/5.png" data-uk-lightbox="{group:'NFS'}" title="NFS">
    <img src="./img/5.png" alt="图片挂了" />
</a></p>
<p>它有如下优点:</p>
<ul>
<li>节约磁盘空间</li>
<li>节约硬件设备</li>
<li>共享用户和应用程序目录</li>
</ul>
<h2 id="toc-5">NFS的安装</h2>
<p>相关rpm软件包:<br>
nfs-utils-<em>.rpm:NFS服务主程序包<br>
Portmap-</em>.rpm:记录服务的端口映射信息<br>
安装命令:</p>
<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre>rpm -ivh nfs-utils-*.rpm
</pre></div>
</td></tr></table></div>
<h2 id="toc-6">NFS服务端的配置</h2>
<ol>
<li>配置<b class="uk-text-success">/etc/exports</b>文件:<ul>
<li>用于定义需要共享的目录，以及访问对象的控制</li>
<li>默认情况下，该文件内容为空，即不共享任何目录</li>
<li>当需要共享目录时，需要管理员手动设置</li>
</ul>
</li>
</ol>
<p>发布共享目录的格式:<br>
共享目录    [客户端1(参数1,参数2,…)] [客户端2(参数1,参数2,…)]…<br>
共享目录:指NFS服务器上需要给客户端共享出来的目录,在设置目录时需要使用绝对路径<br>
客户端  :是指所有可以访问共享目录的计算机<br>
<a href="./img/6.png" data-uk-lightbox="{group:'NFS'}" title="客户端">
    <img src="./img/6.png" alt="图片挂了" />
</a></p>
<p>参数    :是指客户端对共享目录的访问权限设置
<a href="./img/7.png" data-uk-lightbox="{group:'NFS'}" title="参数">
    <img src="./img/7.png" alt="图片挂了" />
</a></p>
<p>示例:
<a href="./img/8.jpg" data-uk-lightbox="{group:'NFS'}" title="示例">
    <img src="./img/8.jpg" alt="图片挂了" />
</a></p>
<p>在NFS服务器上，共享如下目录：</p>
<ul>
<li>/media目录，允许所有客户端访问，但只具有只读权限</li>
<li>/NFS/public目录，允许192.168.1.0/24和196.168.2.0/24网段的客户端访问，且只具有只读权限</li>
<li>/NFS/team1目录，允许来自.team1.apple域的客户端访问，具有读写权限</li>
<li>/NFS/works目录，允许192.168.1.0/24网段客户端访问，并将root用户映射为匿名用户</li>
<li>/NFS/test目录，所有客户端允许访问，所有用户映射为匿名用户，并指定匿名用户的UID和GID均为65534</li>
<li>/NFS/security目录，仅允许192.168.1.254客户端访问，具有读写权限</li>
</ul>
<ol>
<li>配置NFS固定端口
针对场景:NFS服务每次启动,其对应的端口号都会随机变化,这对服务器防火墙配置带来负担.因此,可以通过配置,固定NFS服务所用端口.<br>
配置文件<b class="uk-text-success">/etc/sysconfig/nfs</b>增加如下配置行:<br>
MOUNT_PORT=”5001”<br>
STATD_PORT=“5002”<br>
LOCKD_UDPPORT=“5003”<br>
LOCKD_TCPPORT=“5003”<br>
RQUOTAD_PORT=“5004”</li>
</ol>
<h2 id="toc-7">NFS服务端测试</h2>
<p>NFS服务启动/停止/重启/查询状态命令:</p>
<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre>service portmap start/stop/restart/status
service nfs start/stop/restart/status
</pre></div>
</td></tr></table></div>
<p>开机自动启动NFS服务命令:</p>
<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre>chkconfig nfs on
</pre></div>
</td></tr></table></div>
<p>停止开机自动启动NFS:</p>
<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre>chkconfig nfs off
</pre></div>
</td></tr></table></div>
<h2 id="toc-8">NFS客户端配置</h2>
<ol>
<li>查看NFS服务器的共享目录:<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre>showmount –e 服务器名/IP
</pre></div>
</td></tr></table></div>
</li>
<li>挂载NFS文件系统:<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre>mount –t nfs NFS服务器IP地址/主机名：共享目录  本地挂载点
</pre></div>
</td></tr></table></div>
例：将192.168.1.254上的/tmp目录挂载到本地的/test目录<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre>mount –t nfs 192.168.1.254:/tmp /test
</pre></div>
</td></tr></table></div>
</li>
<li>卸载NFS文件系统:<div class="source"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre>umount 本地挂载点
</pre></div>
</td></tr></table></div>
</li>
<li>开机自动挂载NFS
配置客户端<b class="uk-text-success">/etc/fstab</b>文件<br>
挂载目录格式：<br>
NFS服务器IP:共享目录  本地挂载点  nfs defaults 0 0<br>
<a href="./img/9.jpg" data-uk-lightbox="{group:'NFS'}" title="自动挂载NFS">
 <img src="./img/9.jpg" alt="图片挂了" />
</a></li>
</ol>
<h2 id="toc-9">其他</h2>
<p>可能有人会这么问:如果我需要配置一个大型机群系统,这样每个节点都需要配置,那我岂不是需要一台一
台计算机去操作?这看起来好蠢啊!<br>
不是看起来很蠢,这本来就太蠢了...所以,我们需要一个更高效的方法,找更多的人帮你配!!好吧开个玩笑,
我要说的是有个系统可以帮助我们,那就是大名鼎鼎的Network Information Service,小名叫NIS.但如果不
想出事的话,你最好只是在内网使用,因为它的安全性真的不是很好.</p>

                </div>
                <div class="uk-alert uk-alert-success">
                    若文中有误,欢迎指正
                </div>
                <div class="uk-container uk-container-center">
                    <!-- UY BEGIN -->
                    <div id="uyan_frame"></div>
                    <!-- UY END -->
                </div>
            </div>
        </div>
    </div>

    <a href="#" onclick="gotoTop();return false;" class="totop uk-hidden-small"></a>

    <div class="uk-margin-large-top">
        <div class="uk-container uk-container-center uk-text-center">
            <div class="uk-panel uk-margin-top uk-margin-bottom">
                <p>
                    <a target="_blank" href="http://weibo.com/u/2935065297" class="uk-icon-button uk-icon-weibo"></a>
                    <a target="_blank" href="https://github.com/genialwang" class="uk-icon-button uk-icon-github"></a>
                    <a href="Mailto:wangbiao@ncic.ac.cn" class="uk-icon-button uk-icon-envelope"></a>
                </p>
                <p>&copy GenialWang 2015<p>
            </div>
        </div>
    </div>

    <script src="../static/js/jquery.min.js"></script>
    <script src="../static/js/uikit.min.js"></script>
    <script src="../static/js/components/sticky.min.js"></script>
    <script src="../static/js/components/scrollspy.min.js"></script>
    <script src="../static/js/components/smooth-scroll.min.js"></script>
    <script src="../static/js/genialwang.js"></script>
    <script src="../static/js/components/lightbox.min.js"></script>
    <script src="../static/js/components/google_analytics.js"></script>
    <script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=2057486"></script>
    <script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"5","bdPos":"right","bdTop":"100"},"image":{"viewList":["mshare","tsina","weixin","sqq","qzone","tqq","tieba"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["mshare","tsina","weixin","sqq","qzone","tqq","tieba"]}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
    <script>
        (function(){
            var bp = document.createElement('script');
            var curProtocol = window.location.protocol.split(':')[0];
            if (curProtocol === 'https') {
                bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
            } else {
                bp.src = 'http://push.zhanzhang.baidu.com/push.js';
            }
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(bp, s);
        })();
    </script>
</body>
</html>